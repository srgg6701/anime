Site.Bigbang = (function (window, S, out, $) {
	
	var bigbangOnclickEnable = false,
		initialized = false,
		clickableClass = 'bigbang-clickable';
	
    /**
     * initialize a background image
     * @param {String} backgroundImage: a full path of the image
     * @param {String} backgroundAttachment:  	fixed (Default)	The background image is fixed
												scroll			The background image scrolls with the rest of the page
												stretch			The background image streches and fits to the screen (NOTE: 'Background Repeat' will not use anymore for this option)
     *  @param {String} backgroundAttachment:  	no-repeat (Default)	The background-image will not be repeated
												repeat				The background image will be repeated both vertically and horizontally
												repeat-x			The background image will be repeated only horizontally
												repeat-y			The background image will be repeated only vertically
     * @param {String} backgroundPosition: The background-position property sets the starting position of a background image.
     * @param {String} backgroundURL: Bigbang Background Link when clicking on the image
     * @param {Boolean} backgroundNewwindow: Open the link in a new window
     * @param {String} backgroundColor: a background color
     * @returns {void}
     */
	var initBackgroundImage = function() {
		var body = $('body');
		
		out('initBigbangBackground');
		
		var jsonBB = S.Config.globals.jsonBB;
		
		if (!jsonBB || !jsonBB.backgroundImage || initialized) {
			body.addClass('default-bg-image');
			return;
		}
		
		var image = jsonBB.backgroundImage;
		var attachement = jsonBB.backgroundAttachment;
		var repeat = jsonBB.backgroundRepeat;
		var position = jsonBB.backgroundPosition;
		var url = jsonBB.backgroundURL;
		var newwindow = jsonBB.backgroundNewwindow;
		var bgColor = jsonBB.backgroundColor;
		var bodyStyles = {};
		
		if(attachement == 'stretch'){			
			body.append('<img class="bigbang-fit-screen" alt="" title="Bigbang: Fit to Screen" src="'+image+'" />');
		}else{
			bodyStyles['background-image'] = 'url('+image+')';
			bodyStyles['background-attachment'] = attachement;
			bodyStyles['background-repeat'] = repeat;
			if(position!='') {
				bodyStyles['background-position'] = position;
			}
			else if(bgColor!='') {
				bodyStyles['background-position'] = '0 0';
			}
			else{
				bodyStyles['background-position'] = '0 0';
				bodyStyles['background-color'] = 'transparent';					
			}
			
			body.css(bodyStyles);
		}
		
		//setting onclick function on BB
		if(url){
			body.addClass(clickableClass);
			bigbangOnclickEnable=true;
			BigbangOnclick(url, newwindow);
		}
		
		initialized = true;
	};
	

	var remove = function(){
		$('body').unbind().removeClass(clickableClass);
		$('#bigBangStyleContainer').html('');
	};
	

    /**
     * get the target obj when an user click on the page
     * @param {Event} e : an event
     * @return {Object} targ : the target
     */
	var getTargetObj = function (e) {
		var targ;
		if (!e) { var e = window.event; }
		if (e.target) { targ = e.target; }
		else if (e.srcElement) { targ = e.srcElement; }
		if (targ.nodeType == 3) { // defeat Safari bug
			targ = targ.parentNode;
		}
		return targ;
	};

    /**
     * set an on-click forward url for the background image 
     * @param {String} urllink : an url link
     * @param {Boolean} newwindow : Open the link in a new window
     * @return {void}
     */
	var BigbangOnclick = function(urllink,newwindow){
		$('body').on('click', function(e){
			targetObj = getTargetObj(e);
			
			if($(targetObj).hasClass(clickableClass) && bigbangOnclickEnable) { 
				if(newwindow=='true') { window.open(urllink); }
				else { window.location = urllink; }
			}
			
		});
	};


    return {
        
        /** 
         * Initial Bigbang (background image) for the main frame,product detail, categoryleve1, 
         * 										categorylevel2, article, campaign, and etc.
         * @returns {void}
         */
        initImage : function () {
            /*
             * Initiate the Bigbang background.
             */
            S.RWD.addOnMatch('XL', initBackgroundImage);
        },
        
        removeBigbang: remove
        
    };
	
}(this, Site, Site.Common.out, jQuery));